---
title: minikubeå®‰è£…æ•™ç¨‹
date: 2020-04-18 22:20:02
categories:
- minikube
tags:
- minikube
- ubuntu
- k8s
---

minikube æ˜¯ K8S å®˜æ–¹ä¸ºäº†å¼€å‘è€…èƒ½åœ¨ä¸ªäººç”µè„‘ä¸Šè¿è¡Œ K8S è€Œæä¾›çš„ä¸€å¥—å·¥å…·ã€‚å®ç°ä¸Šæ˜¯é€šè¿‡ Go è¯­è¨€ç¼–å†™ï¼Œé€šè¿‡è°ƒç”¨è™šæ‹ŸåŒ–ç®¡ç†ç¨‹åºï¼Œåˆ›å»ºå‡ºä¸€ä¸ªè¿è¡Œåœ¨è™šæ‹Ÿæœºå†…çš„å•èŠ‚ç‚¹é›†ç¾¤ã€‚

<!-- more -->

æœ¬æ¬¡å®‰è£…çš„minikubeç‰ˆæœ¬ä¸º1.2.0ï¼ˆk8s 1.15.0ï¼‰ï¼Œå¹¶æ²¡æœ‰å®‰è£…æœ€æ–°ç‰ˆ1.9.2ï¼ŒåŸå› æ˜¯æˆ‘è¦åŸºäºk8så®‰è£…kubeflowï¼Œkubeflowå¯¹k8s 1.16åŠä»¥ä¸Šç‰ˆæœ¬å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰€ä»¥ä¸ºé¿å…ä¸å¿…è¦çš„éº»çƒ¦å°±å®‰è£…äº†è€ç‰ˆæœ¬çš„minikubeã€‚

#### å®‰è£…docker

```
apt-get update
 apt-get install -y apt-transport-https ca-certificates curl software-properties-common
 curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
 add-apt-repository \
    "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) \
    Stable"
 apt-get update
 apt-get install -y docker-ce
```

æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ

```
docker run hello-world
```

#### å®‰è£…kubectl

```
curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.15.0/bin/linux/amd64/kubectl
```

å¦‚æœç”±äºå¢™çš„é—®é¢˜æ— æ³•ä¸‹è½½å¯ä»¥è®¿é—®ä¸‹é¢çš„githubåœ°å€ï¼Œç‚¹å‡»é€‰æ‹©å¯¹åº”ç‰ˆæœ¬mdè¿›å…¥ï¼Œæ‰¾åˆ°client binariesï¼ˆä¹Ÿå°±æ˜¯kubectlï¼‰ï¼Œé€‰æ‹©å¯¹åº”æ“ä½œç³»ç»Ÿçš„å®¢æˆ·ç«¯ç„¶åå¤åˆ¶è¿æ¥åœ°å€ä¸‹è½½

```
https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG
```

èµ‹äºˆæ‰§è¡Œæƒé™

```
chmod +x ./kubectl
sudo mv ./kubectl /usr/bin/kubectl
```

æŸ¥çœ‹ç‰ˆæœ¬

```
sudo kubectl version --client
```

ç»“æœå¦‚ä¸‹

```
Client Version: version.Info{Major:"1", Minor:"15", GitVersion:"v1.15.0", GitCommit:"e8462b5b5dc2584fdcd18e6bcfe9f1e4d970a529", GitTreeState:"clean", BuildDate:"2019-06-19T16:40:16Z", GoVersion:"go1.12.5", Compiler:"gc", Platform:"linux/amd64"}
```

#### å®‰è£…minikube

ä¸‹è½½minikube

```
https://github.com/kubernetes/minikube/releases/download/v1.2.0/minikube_1.2.0.deb
```

å®‰è£…minikube

```
sudo dpkg -i minikube_1.2.0.deb
```

#### å¯åŠ¨minikube

```
sudo minikube start --vm-driver=none --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers --cpus 6 --memory 12288 --disk-size=120g --extra-config=apiserver.authorization-mode=RBAC --extra-config=kubelet.resolv-conf=/run/systemd/resolve/resolv.conf --extra-config kubeadm.ignore-preflight-errors=SystemVerification
```

æ‰§è¡Œç»“æœå¦‚ä¸‹è¡¨ç¤ºéƒ¨ç½²å¯åŠ¨æˆåŠŸ

```
ğŸ˜„  minikube v1.2.0 on linux (amd64)
âœ…  using image repository registry.cn-hangzhou.aliyuncs.com/google_containers
ğŸ”¥  Creating none VM (CPUs=6, Memory=12288MB, Disk=120000MB) ...
ğŸ³  Configuring environment for Kubernetes v1.15.0 on Docker 19.03.8
    â–ª apiserver.authorization-mode=RBAC
    â–ª kubelet.resolv-conf=/run/systemd/resolve/resolv.conf
    â–ª kubeadm.ignore-preflight-errors=SystemVerification
    â–ª kubelet.resolv-conf=/run/systemd/resolve/resolv.conf
ğŸšœ  Pulling images ...
ğŸš€  Launching Kubernetes ... 
ğŸ¤¹  Configuring local host environment ...

âš ï¸  The 'none' driver provides limited isolation and may reduce system security and reliability.
âš ï¸  For more information, see:
ğŸ‘‰  https://github.com/kubernetes/minikube/blob/master/docs/vmdriver-none.md

âš ï¸  kubectl and minikube configuration will be stored in /home/liby
âš ï¸  To use kubectl or minikube commands as your own user, you may
âš ï¸  need to relocate them. For example, to overwrite your own settings:

    â–ª sudo mv /home/liby/.kube /home/liby/.minikube $HOME
    â–ª sudo chown -R $USER $HOME/.kube $HOME/.minikube

ğŸ’¡  This can also be done automatically by setting the env var CHANGE_MINIKUBE_NONE_USER=true
âŒ›  Verifying: apiserver proxy etcd scheduler controller dns
ğŸ„  Done! kubectl is now configured to use "minikube"
```

æ‰§è¡Œ`sudo minikube status`æŸ¥çœ‹minikubeè¿è¡Œæƒ…å†µ

```
host: Running
kubelet: Running
apiserver: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.0.110
```

æŸ¥çœ‹podè¿è¡Œæƒ…å†µ

```
sudo kubectl get pods --all-namespaces
```

å¦‚ä¸‹podè¿è¡Œæ­£å¸¸

```
NAMESPACE         NAME                                                           READY   STATUS      RESTARTS   AGE
kube-system       coredns-6967fb4995-svq2c                                       1/1     Running     79         3d19h
kube-system       coredns-6967fb4995-wlk48                                       1/1     Running     79         3d19h
kube-system       etcd-minikube                                                  1/1     Running     0          13h
kube-system       kube-addon-manager-minikube                                    1/1     Running     5          3d19h
kube-system       kube-apiserver-minikube                                        1/1     Running     0          13h
kube-system       kube-controller-manager-minikube                               1/1     Running     45         3d19h
kube-system       kube-proxy-fxp74                                               1/1     Running     5          3d19h
kube-system       kube-scheduler-minikube                                        1/1     Running     37         3d19h
kube-system       kubernetes-dashboard-95564f4f-ql2zr                            1/1     Running     8          3d19h
kube-system       storage-provisioner                                            1/1     Running     0          12h
```

æ‰§è¡Œ`sudo minikube dashboard`æ‰“å¼€Kubernetesæ§åˆ¶å°

```
ğŸ¤”  Verifying dashboard health ...
ğŸš€  Launching proxy ...
ğŸ¤”  Verifying proxy health ...
ğŸ‰  Opening http://127.0.0.1:41123/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/ in your default browser...
```

![](/images/media/é€‰åŒº_084.png)

#### minikubeåŸºæœ¬æ“ä½œ

æ£€æµ‹é›†ç¾¤çŠ¶æ€

```
sudo kubectl cluster-info
```

minikubeçš„é…ç½®æ–‡ä»¶åœ¨å¦‚ä¸‹è·¯å¾„

```
~/.minikube/machines/minikube/config.json
```

æ£€éªŒnodeçŠ¶æ€

```
sudo kubectl get nodes
```

åœæ­¢è¿è¡Œä¸­çš„kubernetesé›†ç¾¤

```
sudo minikube stop
```

åˆ é™¤æœ¬åœ°çš„kubernetesé›†ç¾¤

```
sudo minikube delete
```

å¦‚æœå®‰è£…äº†kubeflowï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å–Kubeflow Dashboardçš„è®¿é—®ipå’Œç«¯å£

```
export INGRESS_HOST=$(sudo minikube ip)
export INGRESS_PORT=$(sudo kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name=="http2")].nodePort}â€™)
```