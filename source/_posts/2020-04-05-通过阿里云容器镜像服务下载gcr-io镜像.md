---
title: 通过阿里云容器镜像服务下载gcr.io镜像
date: 2020-04-05 15:49:25
categories:
- k8s
tags:
- k8s
- github
- docker
---

安装k8s时发现好多镜像都是gcr.io上的，在国内由于被墙而不能正常下载，也就导致了集群不能正常安装。那么问题来了，要怎样才能下载这些镜像呢？我们要寻找免费下载gcr.io镜像的途径，阿里云就提供了这一服务。本文通过github设置代码源下载所需的gcr.io镜像。

<!-- more -->

#### github创建仓库

首先在github创建一个repository，创建好后然后git clone到本地，并在本地创建所需下载的镜像dockerfile，这里本地的目录层级为 镜像名称->版本号->dockerfile。创建之后再把所有的文件push到github仓库。这里是我的github上的[dockderfile仓库](https://github.com/smartliby/docker-library)，大家可以follow我的项目

![](/images/media/选区_057.png)

选取其中一个组件的dockerfile，查看其中的内容

```
FROM gcr.io/kubeflow-images-public/tensorflow-1.15.2-notebook-cpu:1.0.0
MAINTAINER smartliby <liboyuma@qq.com>
```

里面的内容非常少，就两行，其中第一行是基于某个镜像制作的新镜像，第二行为作者信息。通过这个dockerfile我们就可以看出端倪来了，其实我们什么都没做，就是利用阿里云这个介质帮我们翻墙去下载镜像。

#### 登录[阿里云镜像](https://cr.console.aliyun.com/)

创建镜像仓库

![](/images/media/选区_059.png)

选择镜像构建所依赖的在github仓库

![](/images/media/选区_060.png)

进入刚创建的仓库然后选择构建菜单点击添加构建规则

![](/images/media/选区_061.png)

点击立即构建

![](/images/media/选区_063.png)

构建成功

![](/images/media/选区_062.png)

#### 使用镜像

```
docker pull registry.cn-beijing.aliyuncs.com/smartliby/tensorflow-1.15.2-notebook-gpu:1.0.0
docker tag registry.cn-beijing.aliyuncs.com/smartliby/tensorflow-1.15.2-notebook-gpu:1.0.0 gcr.io/kubeflow-images-public/tensorflow-1.15.2-notebook-gpu:1.0.0
```

